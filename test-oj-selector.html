<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste OJ Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .oj-selector {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        .oj-search {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .oj-dropdown {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .oj-option {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .oj-option:hover {
            background-color: #f5f5f5;
        }
        .oj-option.selected {
            background-color: #007bff;
            color: white;
        }
        .oj-selected {
            min-height: 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 10px;
        }
        .oj-tag {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 4px;
            font-size: 12px;
        }
        .oj-tag .remove {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .debug {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Teste do Seletor de Órgãos Julgadores</h1>
    
    <div class="debug" id="debug-info">
        Carregando informações de debug...
    </div>
    
    <div class="oj-selector" id="oj-selector-test">
        <!-- Estrutura será criada dinamicamente -->
    </div>
    
    <button onclick="showSelected()">Mostrar Selecionados</button>
    <button onclick="loadOJList()">Recarregar Lista</button>
    
    <div class="debug" id="selected-info">
        Nenhum OJ selecionado
    </div>

    <script>
        // Simular a estrutura da classe OJSelector
        class OJSelector {
            constructor(containerId, ojList) {
                this.containerId = containerId;
                this.container = document.getElementById(containerId);
                this.ojList = ojList || [];
                this.filteredOJs = [...this.ojList];
                this.selectedOJs = [];
                
                if (this.container) {
                    this.init();
                }
            }
            
            init() {
                this.createHTML();
                this.setupEventListeners();
                this.renderOptions();
            }
            
            createHTML() {
                this.container.innerHTML = `
                    <input type="text" class="oj-search" placeholder="Buscar OJ..." id="${this.containerId}-search">
                    <div class="oj-selected" id="${this.containerId}-selected">
                        <span class="oj-placeholder">Nenhum OJ selecionado</span>
                    </div>
                    <div class="oj-dropdown" id="${this.containerId}-dropdown">
                        <div class="oj-options" id="${this.containerId}-options">
                            <!-- OJ options will be populated by JavaScript -->
                        </div>
                    </div>
                `;
                
                this.searchInput = document.getElementById(`${this.containerId}-search`);
                this.selectedContainer = document.getElementById(`${this.containerId}-selected`);
                this.dropdown = document.getElementById(`${this.containerId}-dropdown`);
                this.optionsContainer = document.getElementById(`${this.containerId}-options`);
            }
            
            setupEventListeners() {
                if (this.searchInput) {
                    this.searchInput.addEventListener('input', (e) => {
                        this.filterOptions(e.target.value);
                    });
                    
                    this.searchInput.addEventListener('focus', () => {
                        this.showDropdown();
                    });
                }
            }
            
            filterOptions(searchTerm) {
                if (!searchTerm) {
                    this.filteredOJs = [...this.ojList];
                } else {
                    this.filteredOJs = this.ojList.filter(oj => 
                        oj.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }
                this.renderOptions();
            }
            
            renderOptions() {
                if (!this.optionsContainer) return;
                
                this.optionsContainer.innerHTML = '';
                
                const maxDisplay = 50;
                const displayOJs = this.filteredOJs.slice(0, maxDisplay);
                
                if (displayOJs.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'oj-no-results';
                    noResults.innerHTML = 'Nenhum OJ encontrado';
                    this.optionsContainer.appendChild(noResults);
                    return;
                }
                
                displayOJs.forEach(oj => {
                    const option = document.createElement('div');
                    option.className = 'oj-option';
                    if (this.selectedOJs.includes(oj)) {
                        option.classList.add('selected');
                    }
                    
                    option.innerHTML = `
                        <input type="checkbox" ${this.selectedOJs.includes(oj) ? 'checked' : ''}>
                        <label>${oj}</label>
                    `;
                    
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.toggleOJ(oj);
                    });
                    
                    this.optionsContainer.appendChild(option);
                });
                
                if (this.filteredOJs.length > maxDisplay) {
                    const moreResults = document.createElement('div');
                    moreResults.innerHTML = `Mostrando ${maxDisplay} de ${this.filteredOJs.length} resultados`;
                    this.optionsContainer.appendChild(moreResults);
                }
            }
            
            toggleOJ(oj) {
                const index = this.selectedOJs.indexOf(oj);
                if (index > -1) {
                    this.selectedOJs.splice(index, 1);
                } else {
                    this.selectedOJs.push(oj);
                }
                
                this.updateSelectedDisplay();
                this.renderOptions();
            }
            
            updateSelectedDisplay() {
                if (!this.selectedContainer) return;
                
                if (this.selectedOJs.length === 0) {
                    this.selectedContainer.innerHTML = '<span class="oj-placeholder">Nenhum OJ selecionado</span>';
                } else {
                    this.selectedContainer.innerHTML = this.selectedOJs.map(oj => 
                        `<span class="oj-tag">${oj} <span class="remove" onclick="removeOJ('${oj}')">&times;</span></span>`
                    ).join('');
                }
            }
            
            showDropdown() {
                if (this.dropdown) {
                    this.dropdown.style.display = 'block';
                }
            }
            
            getSelectedOJs() {
                return [...this.selectedOJs];
            }
        }
        
        // Variáveis globais
        let ojSelector;
        let ojList = [];
        
        // Função para carregar a lista de OJs
        async function loadOJList() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = 'Carregando lista de OJs...';
            
            try {
                const response = await fetch('./src/renderer/orgaos_pje.json');
                const ojData = await response.json();
                
                // Extract all OJs from all cities and flatten into a single array
                const allOJs = [];
                Object.keys(ojData).forEach(cidade => {
                    if (Array.isArray(ojData[cidade])) {
                        allOJs.push(...ojData[cidade]);
                    }
                });
                
                // Sort alphabetically
                ojList = allOJs.sort((a, b) => a.localeCompare(b, 'pt-BR', { sensitivity: 'base' }));
                
                debugInfo.textContent = `Lista carregada com sucesso!\nTotal de OJs: ${ojList.length}\nPrimeiros 5: ${ojList.slice(0, 5).join(', ')}`;
                
                // Inicializar o seletor
                ojSelector = new OJSelector('oj-selector-test', ojList);
                
            } catch (error) {
                debugInfo.textContent = `Erro ao carregar lista: ${error.message}\n\nTentando lista de fallback...`;
                
                // Fallback list
                ojList = [
                    'LIQ2 - Bauru',
                    'Órgão Centralizador de Leilões Judiciais de Limeira',
                    'Órgão Centralizador de Leilões Judiciais de Araraquara',
                    'Vara do Trabalho de Ubatuba',
                    'EXE1 - São José dos Campos'
                ].sort((a, b) => a.localeCompare(b, 'pt-BR', { sensitivity: 'base' }));
                
                debugInfo.textContent += `\n\nUsando lista de fallback com ${ojList.length} OJs`;
                
                // Inicializar o seletor
                ojSelector = new OJSelector('oj-selector-test', ojList);
            }
        }
        
        function showSelected() {
            const selectedInfo = document.getElementById('selected-info');
            if (ojSelector) {
                const selected = ojSelector.getSelectedOJs();
                selectedInfo.textContent = selected.length > 0 ? 
                    `OJs selecionados (${selected.length}):\n${selected.join('\n')}` :
                    'Nenhum OJ selecionado';
            } else {
                selectedInfo.textContent = 'Seletor não inicializado';
            }
        }
        
        function removeOJ(oj) {
            if (ojSelector) {
                ojSelector.toggleOJ(oj);
            }
        }
        
        // Carregar automaticamente quando a página carrega
        document.addEventListener('DOMContentLoaded', loadOJList);
    </script>
</body>
</html>