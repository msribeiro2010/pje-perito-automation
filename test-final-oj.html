<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Seletor de OJs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Teste Final - Seletor de √ìrg√£os Julgadores</h1>
        
        <div class="test-section">
            <div class="test-title">1. Verifica√ß√£o do Arquivo orgaos_pje.json</div>
            <button onclick="testOrgaosFile()">Testar Carregamento do Arquivo</button>
            <div id="file-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">2. Simula√ß√£o do Modal Servidor V2</div>
            <button onclick="simulateModal()">Simular Abertura do Modal</button>
            <div id="modal-result"></div>
            
            <!-- Simula√ß√£o da estrutura do modal -->
            <div id="servidor-v2-modal" style="display: none; margin-top: 20px; padding: 20px; border: 2px solid #007bff; border-radius: 8px;">
                <h3>Modal Servidor V2 (Simula√ß√£o)</h3>
                <label for="oj-selector-main">√ìrg√£os Julgadores:</label>
                <div id="oj-selector-v2" class="oj-selector"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">3. Logs de Depura√ß√£o</div>
            <button onclick="clearLogs()">Limpar Logs</button>
            <div id="debug-logs" class="log-container"></div>
        </div>
    </div>

    <script>
        let debugLogs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLogs.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateLogsDisplay();
        }
        
        function updateLogsDisplay() {
            const logsContainer = document.getElementById('debug-logs');
            logsContainer.innerHTML = debugLogs.join('\n');
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        function clearLogs() {
            debugLogs = [];
            updateLogsDisplay();
        }
        
        function showResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }
        
        async function testOrgaosFile() {
            log('Iniciando teste do arquivo orgaos_pje.json');
            
            try {
                // Tenta carregar o arquivo de diferentes caminhos
                const paths = [
                    './src/renderer/orgaos_pje.json',
                    './orgaos_pje.json',
                    '../src/renderer/orgaos_pje.json'
                ];
                
                let loadedData = null;
                let successPath = null;
                
                for (const path of paths) {
                    try {
                        log(`Tentando carregar: ${path}`);
                        const response = await fetch(path);
                        if (response.ok) {
                            loadedData = await response.json();
                            successPath = path;
                            log(`Sucesso ao carregar: ${path}`);
                            break;
                        } else {
                            log(`Falha ao carregar: ${path} (${response.status})`);
                        }
                    } catch (error) {
                        log(`Erro ao carregar: ${path} - ${error.message}`);
                    }
                }
                
                if (loadedData) {
                    const cities = Object.keys(loadedData);
                    let totalOJs = 0;
                    cities.forEach(city => {
                        totalOJs += loadedData[city].length;
                    });
                    
                    showResult('file-result', 
                        `‚úÖ Arquivo carregado com sucesso!<br>
                        üìÅ Caminho: ${successPath}<br>
                        üèôÔ∏è Cidades: ${cities.length}<br>
                        ‚öñÔ∏è Total de OJs: ${totalOJs}`, 
                        'success'
                    );
                    
                    log(`Arquivo carregado: ${cities.length} cidades, ${totalOJs} OJs`);
                    
                    // Armazena os dados para uso posterior
                    window.testOjData = loadedData;
                    
                } else {
                    showResult('file-result', 
                        '‚ùå N√£o foi poss√≠vel carregar o arquivo orgaos_pje.json de nenhum caminho testado.', 
                        'error'
                    );
                    log('Falha ao carregar arquivo de todos os caminhos testados');
                }
                
            } catch (error) {
                showResult('file-result', 
                    `‚ùå Erro durante o teste: ${error.message}`, 
                    'error'
                );
                log(`Erro durante teste: ${error.message}`, 'error');
            }
        }
        
        function simulateModal() {
            log('Simulando abertura do modal Servidor V2');
            
            try {
                // Mostra o modal simulado
                const modal = document.getElementById('servidor-v2-modal');
                modal.style.display = 'block';
                
                // Simula a inicializa√ß√£o do OJSelector
                if (window.testOjData) {
                    log('Dados de OJ dispon√≠veis, inicializando seletor');
                    initializeTestOJSelector();
                    
                    showResult('modal-result', 
                        '‚úÖ Modal simulado aberto com sucesso!<br>
                        üîß Seletor de OJs inicializado<br>
                        üìã Verifique o campo "√ìrg√£os Julgadores" abaixo', 
                        'success'
                    );
                } else {
                    showResult('modal-result', 
                        '‚ö†Ô∏è Modal aberto, mas dados de OJ n√£o est√£o dispon√≠veis.<br>
                        Execute primeiro o teste do arquivo orgaos_pje.json', 
                        'error'
                    );
                    log('Dados de OJ n√£o dispon√≠veis para inicializar seletor', 'error');
                }
                
            } catch (error) {
                showResult('modal-result', 
                    `‚ùå Erro ao simular modal: ${error.message}`, 
                    'error'
                );
                log(`Erro ao simular modal: ${error.message}`, 'error');
            }
        }
        
        function initializeTestOJSelector() {
            log('Inicializando seletor de OJ de teste');
            
            try {
                // Extrai e ordena todos os OJs
                const allOJs = [];
                Object.keys(window.testOjData).forEach(city => {
                    window.testOjData[city].forEach(oj => {
                        allOJs.push(oj);
                    });
                });
                
                allOJs.sort();
                log(`${allOJs.length} OJs extra√≠dos e ordenados`);
                
                // Cria uma vers√£o simplificada do seletor
                const container = document.getElementById('oj-selector-v2');
                container.innerHTML = `
                    <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background-color: #f8f9fa;">
                        <span style="color: #6c757d;">Nenhum OJ selecionado</span>
                    </div>
                    <input type="text" placeholder="Digite para buscar OJs..." 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;"
                           oninput="filterTestOJs(this.value)">
                    <div id="test-oj-dropdown" style="display: none; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; background: white;">
                        <!-- Op√ß√µes ser√£o inseridas aqui -->
                    </div>
                `;
                
                // Armazena a lista para uso nas fun√ß√µes de filtro
                window.testAllOJs = allOJs;
                
                // Mostra as primeiras op√ß√µes
                showTestOJOptions(allOJs.slice(0, 20));
                
                log('Seletor de teste inicializado com sucesso');
                
            } catch (error) {
                log(`Erro ao inicializar seletor de teste: ${error.message}`, 'error');
            }
        }
        
        function filterTestOJs(searchTerm) {
            if (!window.testAllOJs) return;
            
            const filtered = window.testAllOJs.filter(oj => 
                oj.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            showTestOJOptions(filtered.slice(0, 20));
            
            const dropdown = document.getElementById('test-oj-dropdown');
            dropdown.style.display = filtered.length > 0 ? 'block' : 'none';
        }
        
        function showTestOJOptions(ojs) {
            const dropdown = document.getElementById('test-oj-dropdown');
            if (!dropdown) return;
            
            dropdown.innerHTML = ojs.map(oj => {
                const escapedOj = oj.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
                const displayOj = oj.length > 80 ? oj.substring(0, 77) + '...' : oj;
                return `<div style="padding: 8px; cursor: pointer; border-bottom: 1px solid #eee;" 
                      onmouseover="this.style.backgroundColor='#f8f9fa'" 
                      onmouseout="this.style.backgroundColor='white'"
                      onclick="selectTestOJ('${escapedOj}')" 
                      title="${escapedOj}">
                    ${displayOj}
                </div>`;
            }).join('');
        }
        
        function selectTestOJ(oj) {
            const decodedOj = oj.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            log(`OJ selecionado: ${decodedOj}`);
            
            // Atualiza a exibi√ß√£o do selecionado
            const container = document.getElementById('oj-selector-v2');
            const selectedDiv = container.querySelector('div');
            selectedDiv.innerHTML = `
                <span style="color: #28a745; font-weight: bold;">‚úÖ OJ Selecionado:</span><br>
                <span style="font-size: 14px;">${decodedOj}</span>
            `;
            selectedDiv.style.backgroundColor = '#d4edda';
            selectedDiv.style.borderColor = '#c3e6cb';
            
            // Esconde o dropdown
            document.getElementById('test-oj-dropdown').style.display = 'none';
            
            showResult('modal-result', 
                `‚úÖ Teste conclu√≠do com sucesso!<br>
                üéØ OJ selecionado: ${decodedOj}<br>
                ‚ú® O seletor est√° funcionando corretamente!`, 
                'success'
            );
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            log('P√°gina de teste carregada');
            log('Execute os testes na ordem: 1 ‚Üí 2');
        });
    </script>
</body>
</html>