<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste OJ Selector V2 - Corrigido</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .modal {
            display: block;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* OJ Selector Styles */
        .oj-selector {
            position: relative;
            width: 100%;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            background: white;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .oj-selector:focus-within {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .oj-search {
            width: 100%;
            padding: 12px 16px;
            border: none;
            outline: none;
            font-size: 15px;
            border-radius: 6px 6px 0 0;
            background: #fafbfc;
            transition: background-color 0.2s ease;
        }
        
        .oj-search:focus {
            background: white;
        }
        
        .oj-search::placeholder {
            color: #8b9dc3;
            font-weight: 400;
        }
        
        .oj-selected {
            min-height: 50px;
            padding: 12px 16px;
            border-top: 1px solid #e1e8ed;
            background: #f8f9fa;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .oj-placeholder {
            color: #8b9dc3;
            font-style: italic;
            font-weight: 400;
        }
        
        .oj-tag {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
            transition: all 0.2s ease;
        }
        
        .oj-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .oj-tag .remove {
            cursor: pointer;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: background-color 0.2s ease;
            font-size: 14px;
            line-height: 1;
        }
        
        .oj-tag .remove:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }
        
        .oj-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e1e8ed;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .oj-option {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .oj-option:hover {
            background: #f8f9fa;
            padding-left: 20px;
        }
        
        .oj-option.selected {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 500;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Teste OJ Selector V2 - Versão Corrigida</h1>
        <p>Este teste verifica se o seletor de OJs V2 está funcionando corretamente após as correções.</p>
        
        <div class="modal">
            <h3>Modal Servidor V2 - Simulação</h3>
            
            <div class="form-group">
                <label>CPF do Servidor:</label>
                <input type="text" placeholder="000.000.000-00" value="123.456.789-00">
            </div>
            
            <div class="form-group">
                <label>Órgãos Julgadores:</label>
                <div class="orgaos-selector">
                    <div id="oj-selector-v2" class="oj-selector">
                        <input type="text" class="oj-search" placeholder="Buscar órgãos julgadores..." id="oj-search-v2">
                        <div class="oj-selected" id="oj-selected-v2">
                            <span class="oj-placeholder">Nenhum órgão selecionado</span>
                        </div>
                        <div class="oj-dropdown" id="oj-dropdown-v2" style="display: none;">
                            <div class="oj-options" id="oj-options-v2">
                                <!-- Options will be populated dynamically -->
                            </div>
                        </div>
                        <input type="hidden" name="selected-ojs" value="">
                    </div>
                    <small>Selecione um ou mais órgãos julgadores do arquivo orgaos_pje.json</small>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="testOJSelector()">Testar Seletor</button>
            <button class="btn btn-success" onclick="getSelectedOJs()">Ver Selecionados</button>
        </div>
        
        <div class="status" id="status">
            <strong>Status:</strong> Aguardando teste...
        </div>
    </div>

    <script>
        // Dados de teste dos OJs
        const testOJData = [
            "1ª Vara Cível de São Paulo",
            "2ª Vara Cível de São Paulo", 
            "3ª Vara Cível de São Paulo",
            "1ª Vara Criminal de São Paulo",
            "2ª Vara Criminal de São Paulo",
            "Vara da Fazenda Pública de São Paulo",
            "1ª Vara de Família de São Paulo",
            "2ª Vara de Família de São Paulo",
            "Vara de Sucessões de São Paulo",
            "1ª Vara do Trabalho de São Paulo",
            "2ª Vara do Trabalho de São Paulo",
            "Tribunal Regional do Trabalho - 2ª Região",
            "1ª Vara Federal de São Paulo",
            "2ª Vara Federal de São Paulo",
            "Tribunal Regional Federal - 3ª Região"
        ];

        // Classe OJSelector (versão corrigida)
        class OJSelector {
            constructor(containerId, ojList) {
                this.containerId = containerId;
                this.ojList = ojList;
                this.selectedOJs = [];
                this.filteredOJs = [...ojList];
                this.init();
            }

            init() {
                this.container = document.getElementById(this.containerId);
                console.log('OJSelector init - Container:', this.container);
                
                if (!this.container) {
                    console.error('Container não encontrado:', this.containerId);
                    return;
                }
                
                // Buscar os elementos já existentes no HTML
                this.searchInput = this.container.querySelector('.oj-search');
                this.selectedContainer = this.container.querySelector('.oj-selected');
                this.dropdown = this.container.querySelector('.oj-dropdown');
                this.optionsContainer = this.container.querySelector('.oj-options');
                this.hiddenInput = this.container.querySelector('input[type="hidden"]');
                
                console.log('OJSelector elementos encontrados:');
                console.log('- searchInput:', !!this.searchInput);
                console.log('- selectedContainer:', !!this.selectedContainer);
                console.log('- dropdown:', !!this.dropdown);
                console.log('- optionsContainer:', !!this.optionsContainer);
                console.log('- hiddenInput:', !!this.hiddenInput);
                
                if (!this.searchInput || !this.selectedContainer || !this.dropdown || !this.optionsContainer || !this.hiddenInput) {
                    console.error('Alguns elementos do OJSelector não foram encontrados');
                    return;
                }
                
                this.setupEventListeners();
                this.renderOptions();
                this.updateSelectedDisplay();
                
                updateStatus('✅ OJ Selector V2 inicializado com sucesso!');
            }

            setupEventListeners() {
                // Search functionality
                this.searchInput.addEventListener('input', (e) => {
                    this.filterOptions(e.target.value);
                });

                // Show dropdown on focus
                this.searchInput.addEventListener('focus', () => {
                    this.showDropdown();
                });

                // Hide dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.container.contains(e.target)) {
                        this.hideDropdown();
                    }
                });
            }

            filterOptions(searchTerm) {
                const term = searchTerm.toLowerCase().trim();
                
                if (!term) {
                    this.filteredOJs = [...this.ojList];
                } else {
                    this.filteredOJs = this.ojList.filter(oj => 
                        oj.toLowerCase().includes(term)
                    );
                }
                
                this.renderOptions();
            }

            renderOptions() {
                this.optionsContainer.innerHTML = '';
                
                this.filteredOJs.forEach(oj => {
                    const option = document.createElement('div');
                    option.className = 'oj-option';
                    option.textContent = oj;
                    
                    if (this.selectedOJs.includes(oj)) {
                        option.classList.add('selected');
                    }
                    
                    option.addEventListener('click', () => {
                        this.toggleOJ(oj);
                    });
                    
                    this.optionsContainer.appendChild(option);
                });
            }

            toggleOJ(oj) {
                const index = this.selectedOJs.indexOf(oj);
                
                if (index > -1) {
                    this.selectedOJs.splice(index, 1);
                } else {
                    this.selectedOJs.push(oj);
                }
                
                this.updateSelectedDisplay();
                this.renderOptions();
                this.updateHiddenInput();
                
                updateStatus(`OJ ${index > -1 ? 'removido' : 'adicionado'}: ${oj}`);
            }

            updateSelectedDisplay() {
                if (this.selectedOJs.length === 0) {
                    this.selectedContainer.innerHTML = '<span class="oj-placeholder">Nenhum órgão selecionado</span>';
                } else {
                    this.selectedContainer.innerHTML = this.selectedOJs.map(oj => 
                        `<div class="oj-tag">
                            ${oj}
                            <span class="remove" onclick="window.ojSelector.removeOJ('${oj}')">&times;</span>
                        </div>`
                    ).join('');
                }
            }

            removeOJ(oj) {
                this.toggleOJ(oj);
            }

            updateHiddenInput() {
                this.hiddenInput.value = JSON.stringify(this.selectedOJs);
            }

            showDropdown() {
                this.dropdown.style.display = 'block';
            }

            hideDropdown() {
                this.dropdown.style.display = 'none';
            }

            getSelectedOJs() {
                return this.selectedOJs;
            }
        }

        // Funções de teste
        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<strong>Status:</strong> ${message}`;
        }

        function testOJSelector() {
            updateStatus('🔄 Inicializando OJ Selector V2...');
            
            try {
                window.ojSelector = new OJSelector('oj-selector-v2', testOJData);
                console.log('OJ Selector criado:', window.ojSelector);
            } catch (error) {
                console.error('Erro ao criar OJ Selector:', error);
                updateStatus('❌ Erro ao inicializar OJ Selector: ' + error.message);
            }
        }

        function getSelectedOJs() {
            if (window.ojSelector) {
                const selected = window.ojSelector.getSelectedOJs();
                updateStatus(`📋 OJs Selecionados (${selected.length}): ${selected.join(', ') || 'Nenhum'}`);
                console.log('OJs Selecionados:', selected);
            } else {
                updateStatus('❌ OJ Selector não foi inicializado. Clique em "Testar Seletor" primeiro.');
            }
        }

        // Inicializar automaticamente quando a página carregar
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('📄 Página carregada. Clique em "Testar Seletor" para inicializar.');
        });
    </script>
</body>
</html>