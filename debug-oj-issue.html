<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug OJ Selector Issue</title>
    <link rel="stylesheet" href="src/renderer/styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .debug-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>Debug: Seletor de OJs V2</h1>
        
        <div class="debug-section">
            <div class="debug-title">1. Teste de Carregamento do Script</div>
            <div id="script-status" class="debug-result info">Verificando...</div>
            <button onclick="testScriptLoading()">Testar Carregamento</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">2. Teste de Carregamento do JSON</div>
            <div id="json-status" class="debug-result info">Verificando...</div>
            <button onclick="testJSONLoading()">Testar JSON</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">3. Teste do Container</div>
            <div id="container-status" class="debug-result info">Verificando...</div>
            <div class="test-container">
                <div id="oj-selector-v2" class="oj-selector">
                    <!-- Estrutura será criada dinamicamente -->
                </div>
            </div>
            <button onclick="testContainer()">Testar Container</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">4. Teste de Inicialização do Seletor</div>
            <div id="selector-status" class="debug-result info">Verificando...</div>
            <button onclick="testSelectorInit()">Inicializar Seletor</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">5. Logs do Console</div>
            <div id="console-logs" class="debug-result info">Aguardando logs...</div>
            <button onclick="clearLogs()">Limpar Logs</button>
        </div>
    </div>

    <script src="src/renderer/script.js"></script>
    <script>
        let logs = [];
        
        // Capturar logs do console
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logs.push({type: 'log', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push({type: 'error', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logs.push({type: 'warn', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalWarn.apply(console, args);
        };
        
        function updateConsoleLogs() {
            const logsDiv = document.getElementById('console-logs');
            if (logs.length === 0) {
                logsDiv.innerHTML = '<div class="info">Nenhum log ainda...</div>';
                return;
            }
            
            let html = '';
            logs.slice(-10).forEach(log => {
                const className = log.type === 'error' ? 'error' : log.type === 'warn' ? 'error' : 'info';
                html += `<div class="${className}">[${log.time}] ${log.type.toUpperCase()}: ${log.message}</div>`;
            });
            logsDiv.innerHTML = html;
        }
        
        function clearLogs() {
            logs = [];
            updateConsoleLogs();
        }
        
        function testScriptLoading() {
            const statusDiv = document.getElementById('script-status');
            
            try {
                if (typeof OJSelector !== 'undefined') {
                    statusDiv.innerHTML = '<div class="success">✓ Classe OJSelector carregada com sucesso</div>';
                } else {
                    statusDiv.innerHTML = '<div class="error">✗ Classe OJSelector não encontrada</div>';
                }
                
                if (typeof initializeOJSelectorV2 !== 'undefined') {
                    statusDiv.innerHTML += '<div class="success">✓ Função initializeOJSelectorV2 carregada</div>';
                } else {
                    statusDiv.innerHTML += '<div class="error">✗ Função initializeOJSelectorV2 não encontrada</div>';
                }
                
                if (typeof window.ojList !== 'undefined') {
                    statusDiv.innerHTML += `<div class="info">ℹ window.ojList: ${window.ojList ? window.ojList.length + ' itens' : 'null'}</div>`;
                } else {
                    statusDiv.innerHTML += '<div class="info">ℹ window.ojList não definido ainda</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">✗ Erro ao verificar script: ${error.message}</div>`;
            }
        }
        
        function testJSONLoading() {
            const statusDiv = document.getElementById('json-status');
            statusDiv.innerHTML = '<div class="info">Carregando JSON...</div>';
            
            fetch('orgaos_pje.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('JSON carregado:', data);
                    
                    let totalOJs = 0;
                    Object.keys(data).forEach(cidade => {
                        if (Array.isArray(data[cidade])) {
                            totalOJs += data[cidade].length;
                        }
                    });
                    
                    statusDiv.innerHTML = `
                        <div class="success">✓ JSON carregado com sucesso</div>
                        <div class="info">ℹ Cidades: ${Object.keys(data).length}</div>
                        <div class="info">ℹ Total de OJs: ${totalOJs}</div>
                    `;
                })
                .catch(error => {
                    console.error('Erro ao carregar JSON:', error);
                    statusDiv.innerHTML = `<div class="error">✗ Erro ao carregar JSON: ${error.message}</div>`;
                });
        }
        
        function testContainer() {
            const statusDiv = document.getElementById('container-status');
            const container = document.getElementById('oj-selector-v2');
            
            if (!container) {
                statusDiv.innerHTML = '<div class="error">✗ Container oj-selector-v2 não encontrado</div>';
                return;
            }
            
            statusDiv.innerHTML = `
                <div class="success">✓ Container encontrado</div>
                <div class="info">ℹ ID: ${container.id}</div>
                <div class="info">ℹ Classes: ${container.className}</div>
                <div class="info">ℹ HTML atual: ${container.innerHTML || '(vazio)'}</div>
            `;
        }
        
        function testSelectorInit() {
            const statusDiv = document.getElementById('selector-status');
            
            try {
                console.log('Iniciando teste do seletor...');
                
                if (typeof initializeOJSelectorV2 === 'undefined') {
                    statusDiv.innerHTML = '<div class="error">✗ Função initializeOJSelectorV2 não encontrada</div>';
                    return;
                }
                
                statusDiv.innerHTML = '<div class="info">Inicializando seletor...</div>';
                
                // Chamar a função de inicialização
                initializeOJSelectorV2();
                
                // Verificar se foi criado
                setTimeout(() => {
                    const container = document.getElementById('oj-selector-v2');
                    if (container && container.innerHTML.trim() !== '') {
                        statusDiv.innerHTML = `
                            <div class="success">✓ Seletor inicializado com sucesso</div>
                            <div class="info">ℹ HTML gerado: ${container.innerHTML.length} caracteres</div>
                        `;
                    } else {
                        statusDiv.innerHTML = '<div class="error">✗ Seletor não foi inicializado corretamente</div>';
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao inicializar seletor:', error);
                statusDiv.innerHTML = `<div class="error">✗ Erro: ${error.message}</div>`;
            }
        }
        
        // Executar testes automáticos quando a página carregar
        window.addEventListener('load', () => {
            console.log('Página carregada, executando testes automáticos...');
            setTimeout(() => {
                testScriptLoading();
                testJSONLoading();
                testContainer();
            }, 1000);
        });
    </script>
</body>
</html>